---
- name: create virtualenv
  become: true
  become_user: "{{ username }}"
  pip:
    name: pip
    version: 9.0.1
    virtualenv: "/home/{{ username }}/.pyvenv"
    virtualenv_command: "/usr/local/pythonz/pythons/CPython-{{ python_version }}/bin/virtualenv"

- name: clone project
  become: true
  become_user: "{{ username }}"
  git:
    accept_hostkey: yes
    clone: yes
    repo: "{{ repo }}"
    version: "{{ version }}"
    dest: "/home/{{ username }}/{{ service_name }}"
    force: yes
    remote: origin
  register: clone

- name: install dependencies
  become: true
  become_user: "{{ username }}"
  pip:
    requirements: "/home/{{ username }}/{{ service_name }}/requirements.txt"
    executable: "/home/{{ username }}/.pyvenv/bin/pip"
  when: clone.changed
